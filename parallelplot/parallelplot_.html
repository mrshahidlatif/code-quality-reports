<!DOCTYPE html>
<html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/d3.parcoords.css">
<title>Parallelplot</title>
<style>
body {
	font-family: calibri;
	margin: 0px;
	padding: 0px;
}

.text-center {
	text-align: center;
	margin: 6px 0;
}

#example {
	height:320px;
	width: 100%;
}

#example_container {
	width: 600px;
	height: 320px;
	position: relative;
	margin: auto;
}

#example {
	width: 600px;
	height: 320px;
	position: absolute;
}
</style>

<body>
<h3 class="text-center" style="margin: 6px 0;">Parallel Coordinates Plot</h3>
<div id="example_container">
	<div id="example" class="parcoords"></div>
</div>

<script src="lib/jquery-2.2.2.min.js"></script>
<script src="lib/d3.min.js"></script>
<script src="lib/d3.parcoords.js"></script>

<script>
// linear color scale
var blue_to_brown = d3.scale.linear()
  .domain([9, 50])
  .range(["steelblue", "brown"])
  .interpolate(d3.interpolateLab);

// interact with this variable from a javascript console
var pc1;

// load csv file and create the chart
function parallelplot(data) {
	data.forEach(function(d, i){
		d.index = i;
		delete d.cname;
	});

	var w = (data.columns.length-1)*50;
	$("#example_container").css({width: w+"px"});
	$("#example").css({width: w+"px"});

  pc1 = d3.parcoords()("#example")
    .data(data)
    .hideAxis(["name"])
    .composite("darken")
    .color(function(d) { return "steelblue"; })  // quantitative color scale
    .alpha(0.35)
    .render()
    .brushMode("1D-axes")  // enable brushing
    .interactive()  // command line mode

  var explore_count = 0;
  var exploring = {};
  var explore_start = false;
  pc1.svg
    .selectAll(".dimension")
    .style("cursor", "pointer")
    .on("click", function(d) {
      exploring[d] = d in exploring ? false : true;
      event.preventDefault();
      if (exploring[d]) d3.timer(explore(d,explore_count));
    });

  function explore(dimension,count) {
    if (!explore_start) {
      explore_start = true;
      d3.timer(pc1.brush);
    }
    var speed = (Math.round(Math.random()) ? 1 : -1) * (Math.random()+0.5);
    return function(t) {
      if (!exploring[dimension]) return true;
      var domain = pc1.yscale[dimension].domain();
      var width = (domain[1] - domain[0])/4;

      var center = width*1.5*(1+Math.sin(speed*t/1200)) + domain[0];

      pc1.yscale[dimension].brush.extent([
        d3.max([center-width*0.01, domain[0]-width/400]),
        d3.min([center+width*1.01, domain[1]+width/100])
      ])(pc1.g()
          .filter(function(d) {
            return d == dimension;
          })
      );
    };
  };

}

window.parent._parallelplot = parallelplot;
</script>
</body>
</html>
